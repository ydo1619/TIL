# 파이썬 연습 20일차

## 데이터분석 실무 with 파이썬

### unit 4 (코로나 바이러스(COVID19)의 영향으로 중국인 관광객이 얼마나 줄었을까?)

```python
import pandas as pd
import numpy as np

kto_201901 = pd.read_excel('./files/kto_201901.xlsx',
                          header = 1,
                          usecols = 'A:G',
                          skipfooter = 4)
kto_201901.head()
>>>
국적	관광	상용	공용	유학/연수	기타	계
0	아시아주	765082	10837	1423	14087	125521	916950
1	일본	198805	2233	127	785	4576	206526
2	대만	86393	74	22	180	1285	87954
3	홍콩	34653	59	2	90	1092	35896
4	마카오	2506	2	0	17	45	2570

kto_201901.info()
>>>
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 67 entries, 0 to 66
Data columns (total 7 columns):
 #   Column  Non-Null Count  Dtype 
---  ------  --------------  ----- 
 0   국적      67 non-null     object
 1   관광      67 non-null     int64 
 2   상용      67 non-null     int64 
 3   공용      67 non-null     int64 
 4   유학/연수   67 non-null     int64 
 5   기타      67 non-null     int64 
 6   계       67 non-null     int64 
dtypes: int64(6), object(1)
memory usage: 3.8+ KB
    
kto_201901.describe()
>>>
	관광	상용	공용	유학/연수	기타	계
count	67.00000	67.000000	67.000000	67.000000	67.000000	67.000000
mean	26396.80597	408.208955	132.507463	477.462687	5564.208955	32979.194030
std	102954.04969	1416.040302	474.406339	2009.484800	17209.438418	122821.369969
min	0.00000	0.000000	0.000000	0.000000	16.000000	54.000000
25%	505.00000	14.500000	2.500000	17.500000	260.000000	927.000000
50%	1304.00000	45.000000	14.000000	43.000000	912.000000	2695.000000
75%	8365.00000	176.500000	38.000000	182.000000	2824.500000	14905.500000
max	765082.00000	10837.000000	2657.000000	14087.000000	125521.000000	916950.000000

conditions = (kto_201901['관광'] == 0) | \
            (kto_201901['상용'] == 0) | \
            (kto_201901['공용'] == 0) | \
            (kto_201901['유학/연수'] == 0)

kto_201901[conditions]
>>>
	국적	관광	상용	공용	유학/연수	기타	계
4	마카오	2506	2	0	17	45	2570
20	이스라엘	727	12	0	9	57	805
22	우즈베키스탄	1958	561	0	407	2828	5754
38	스위스	613	18	0	19	97	747
45	그리스	481	17	4	0	273	775
46	포르투갈	416	14	0	13	121	564
51	크로아티아	226	12	0	3	250	491
54	폴란드	713	10	0	27	574	1324
59	대양주 기타	555	3	4	0	52	614
63	기타대륙	33	4	0	1	16	54
64	국적미상	33	4	0	1	16	54
65	교포소계	0	0	0	0	15526	15526
66	교포	0	0	0	0	15526	15526
```



#### 기준년월 삽입하기

```python
kto_201901['기준년월'] = '2019-01'
kto_201901
>>>

국적	관광	상용	공용	유학/연수	기타	계	기준년월
0	아시아주	765082	10837	1423	14087	125521	916950	2019-01
1	일본	198805	2233	127	785	4576	206526	2019-01
2	대만	86393	74	22	180	1285	87954	2019-01
3	홍콩	34653	59	2	90	1092	35896	2019-01
4	마카오	2506	2	0	17	45	2570	2019-01
...	...	...	...	...	...	...	...	...
62	아프리카 기타	768	718	90	206	908	2690	2019-01
63	기타대륙	33	4	0	1	16	54	2019-01
64	국적미상	33	4	0	1	16	54	2019-01
65	교포소계	0	0	0	0	15526	15526	2019-01
66	교포	0	0	0	0	15526	15526	2019-01
```



```python
kto_201901['국적'].nunique()
kto_201901['국적'].value_counts()
>>>
아시아주     1
러시아      1
네덜란드     1
스웨덴      1
스위스      1
        ..
캐나다      1
멕시코      1
브라질      1
미주 기타    1
교포       1
Name: 국적, Length: 67, dtype: int64

# 국가명 아닌것들 지우기
continents_list = ['아시아주', '미주', '구주', '대양주', '아프리카주', '기타대륙', '교포소계']
condition = (kto_201901.국적.isin(continents_list)) 
kto_201901[condition == False]
kto_201901_country = kto_201901[~condition]
kto_201901_country.head()
>>>
국적	관광	상용	공용	유학/연수	기타	계	기준년월
1	일본	198805	2233	127	785	4576	206526	2019-01
2	대만	86393	74	22	180	1285	87954	2019-01
3	홍콩	34653	59	2	90	1092	35896	2019-01
4	마카오	2506	2	0	17	45	2570	2019-01
5	태국	34004	37	199	96	6998	41334	2019-01
```



#### 대륙지정

```python
continents = ['아시아']*25 + ['아메리카']*5 + ['유럽']*23 + ['오세아니아']*3 \
+ ['아프리카']*2 + ['기타대륙'] + ['교포']

continents

kto_201901_country_newindex['대륙'] = continents
kto_201901_country_newindex.head()
>>>
	국적	관광	상용	공용	유학/연수	기타	계	기준년월	대륙
0	일본	198805	2233	127	785	4576	206526	2019-01	아시아
1	대만	86393	74	22	180	1285	87954	2019-01	아시아
2	홍콩	34653	59	2	90	1092	35896	2019-01	아시아
3	마카오	2506	2	0	17	45	2570	2019-01	아시아
4	태국	34004	37	199	96	6998	41334	2019-01	아시아
```



#### 관광객비율

```python
kto_201901_country_newindex['관광객비율(%)'] = \
round(kto_201901_country_newindex['관광'] / kto_201901_country_newindex['계'] * 100, 2)
kto_201901_country_newindex.head()
>>>
국적	관광	상용	공용	유학/연수	기타	계	기준년월	대륙	관광객비율(%)
0	일본	198805	2233	127	785	4576	206526	2019-01	아시아	96.26
1	대만	86393	74	22	180	1285	87954	2019-01	아시아	98.23
2	홍콩	34653	59	2	90	1092	35896	2019-01	아시아	96.54
3	마카오	2506	2	0	17	45	2570	2019-01	아시아	97.51
4	태국	34004	37	199	96	6998	41334	2019-01	아시아	82.27

# 관광객 비율순 정렬
kto_201901_country_newindex.sort_values(by = '관광객비율(%)', ascending = False)
```



#### 국가별 전체 외국인 관광객 대비 차지하는 비율

```python
kto_201901_country_newindex['전체비율(%)'] = \
		round(kto_201901_country_newindex['관광']*100 / tourist_sum,1)
kto_201901_country_newindex.head()
>>>
	국적	관광	상용	공용	유학/연수	기타	계	기준년월	대륙	관광객비율(%)	전체비율(%)
0	일본	198805	2233	127	785	4576	206526	2019-01	아시아	96.26	22.5
1	대만	86393	74	22	180	1285	87954	2019-01	아시아	98.23	9.8
2	홍콩	34653	59	2	90	1092	35896	2019-01	아시아	96.54	3.9
3	마카오	2506	2	0	17	45	2570	2019-01	아시아	97.51	0.3
4	태국	34004	37	199	96	6998	41334	2019-01	아시아	82.27	3.8

# 전체 비율순 정렬
kto_201901_country_newindex.sort_values('전체비율(%)', ascending=False)
```



#### 시각화하기

```python
import pandas as pd 
df = pd.read_excel('./files/kto_total.xlsx')
df.head()
>>>
국적	관광	상용	공용	유학/연수	기타	계	기준년월	대륙	관광객비율(%)	전체비율(%)
0	일본	202825	1750	89	549	3971	209184	2010-01	아시아	97.0	50.6
1	대만	35788	41	17	37	516	36399	2010-01	아시아	98.3	8.9
2	홍콩	13874	55	0	21	595	14545	2010-01	아시아	95.4	3.5
3	마카오	554	0	0	0	0	554	2010-01	아시아	100.0	0.1
4	태국	13374	39	13	53	4335	17814	2010-01	아시아	75.1	3.3

from matplotlib import font_manager, rc
import platform 

if platform.system() == 'Windows': 
    path = 'c:/Windows/Fonts/malgun.ttf'
    font_name = font_manager.FontProperties(fname=path).get_name()
    rc('font', family=font_name)
elif platform.system() == 'Darwin':
    rc('font', family='AppleGothic')
else: 
    print('Check your OS system')
    
import matplotlib.pyplot as plt
import seaborn as sns

for cntry in cntry_list: 
    # 국적 관광객만 추출 
    condition = (df['국적'] == cntry)
    df_filter = df[condition]

    # 그래프 그리기 
    ## 그래프 크기 조절 
    plt.figure(figsize = (12, 4))
    
    ## 그래프 내용 설정 
    plt.plot(df_filter['기준년월'], df_filter['관광'])

    ## 그래프 타이틀, X축, Y축 이름 달기 
    plt.title('{} 국적의 관광객 추이'.format(cntry))
    plt.xlabel('기준년월')
    plt.ylabel('관광객수')

    ## x 축 눈금 값 설정 
    plt.xticks(['2010-01', '2011-01', '2012-01', '2013-01', '2014-01', '2015-01', '2016-01', '2017-01', '2018-01', '2019-01', '2020-01'])

    ## 그래프 표현하기 
    plt.show()
```



#### 년도, 월 추가하기

```python
df['년도'] = df['기준년월'].str.slice(0, 4)
df['월'] = df['기준년월'].str.slice(5, 7)

df.head()
>>>
국적	관광	상용	공용	유학/연수	기타	계	기준년월	대륙	관광객비율(%)	전체비율(%)	년도	월
0	일본	202825	1750	89	549	3971	209184	2010-01	아시아	97.0	50.6	2010	01
1	대만	35788	41	17	37	516	36399	2010-01	아시아	98.3	8.9	2010	01
2	홍콩	13874	55	0	21	595	14545	2010-01	아시아	95.4	3.5	2010	01
3	마카오	554	0	0	0	0	554	2010-01	아시아	100.0	0.1	2010	01
4	태국	13374	39	13	53	4335	17814	2010-01	아시아	75.1	3.3	2010	01
```



#### 피벗테이블을 이용해 년도별 월 중국인 관광객 수 파악하기

```python
condition = (df['국적'] == '중국')

df_filter = df[condition]
df_filter.head()

df_pivot = df_filter.pivot_table(values = '관광',
                                index = '년도',
                                columns = '월')

df_pivot
>>>

월	01	02	03	04	05	06	07	08	09	10	11	12
년도												
2010	40425.0	60590.0	50330.0	84252.0	89056.0	87080.0	122432.0	142180.0	93545.0	107237.0	75686.0	58987.0
2011	55070.0	53863.0	72003.0	86397.0	85668.0	108060.0	170524.0	178937.0	144704.0	141824.0	113856.0	101605.0
2012	106606.0	74895.0	110965.0	166843.0	154841.0	179074.0	258907.0	268988.0	203857.0	204866.0	155503.0	148320.0
2013	148118.0	169395.0	182850.0	250549.0	196306.0	280319.0	417991.0	472005.0	353359.0	249850.0	208175.0	210950.0
2014	230706.0	219533.0	313400.0	429419.0	410971.0	429991.0	540683.0	588181.0	423133.0	459708.0	381118.0	345957.0
2015	327225.0	413096.0	386386.0	536428.0	517154.0	223101.0	172075.0	372990.0	453670.0	518651.0	409635.0	381722.0
2016	456636.0	424232.0	500018.0	601460.0	614636.0	671493.0	823016.0	747818.0	611538.0	588561.0	452082.0	456882.0
2017	489256.0	458952.0	263788.0	158784.0	172527.0	181507.0	207099.0	226153.0	229172.0	244541.0	223743.0	260983.0
2018	236825.0	237075.0	281020.0	283533.0	284317.0	303405.0	332657.0	360982.0	326438.0	382922.0	327664.0	345135.0
2019	320113.0	324291.0	369165.0	410542.0	413949.0	395196.0	439699.0	451570.0	432018.0	476460.0	426849.0	433577.0
2020	393336.0	49520.0	5040.0	522.0	179.0	NaN	NaN	NaN	NaN	NaN	NaN	NaN
```



#### 중국 관관객 히트맵으로 표현하기

```python
condition = (df['국적'] == '중국')

df_filter = df[condition]
df_filter.head()

import seaborn as sns
import numpy as np

for cntry in cntry_list:
    condition = df['국적'] == cntry
    
    df_filter = df[condition]
    
    df_pivot = df_filter.pivot_table(values='관광',
                                    index = '년도',
                                    columns = '월')
    
    plt.figure(figsize = (10, 8))
    
    sns.heatmap(df_pivot, annot = True,
               fmt = '.0f',
               cmap = 'rocket_r')
    
    plt.title('{} 관광객 히트맵'.format(cntry))
    
    plt.show()
```

