# íŒŒì´ì¬ ì—°ìŠµ 21ì¼ì°¨

## ë°ì´í„°ë¶„ì„ ì‹¤ë¬´ with íŒŒì´ì¬

### unit 5 (ê°€ì¥ ëœ¨ëŠ” ì œì£¼ë„ í•«í”Œë ˆì´ìŠ¤ëŠ” ì–´ë””ì¼ê¹Œ?)

```python
from selenium import webdriver
from selenium.webdriver.chrome.service import Service

from bs4 import BeautifulSoup

import pandas as pd
import numpy as np
import time

ser = Service('../chrome_driver/chromedriver.exe')
driver = webdriver.Chrome(service = ser)
url = 'https://www.instagram.com'
driver.get(url)
time.sleep(2)
```



#### ì œì£¼ë„ ë§›ì§‘ í¬ë¡¬ì—ì„œ ê²€ìƒ‰í•˜ê¸°

```python
def insta_searching(word):
    
    url = 'https://www.instagram.com/explore/tags/' + word
    return url

word = "ì œì£¼ë„ë§›ì§‘"
url = insta_searching(word)
driver.get(url)
time.sleep(5)
```



```python
from selenium.webdriver.common.by import By

def select_first(driver):
    # first = driver.find_element_by_css_selector('div._9AhH0')
    first = driver.find_element(By.CSS_SELECTOR, 'div._9AhH0')
    first.click()
    time.sleep(3)
    
select_first(driver)

html = driver.page_source
soup = BeautifulSoup(html, 'html.parser')

soup

import unicodedata

content = soup.select('div.C4VMK > span')[0].text
content

import re

tags = re.findall(r'#[^\s#,\\]+', content)
# tags = re.findall(r'#\w+', content)

tags
>>>
['#ì œì£¼ë„ë§›ì§‘',
 '#ì œì£¼ë§›ì§‘',
 '#ì‹ ì œì£¼ë§›ì§‘',
 '#ë…¸í˜•ë§›ì§‘',
 '#ë…¸í˜•ë™ë§›ì§‘',
 '#ë…¸í˜•ë§›ì§‘ì¶”ì²œ',
 '#ì œì£¼ë„ëˆê¹ŒìŠ¤',
 '#ì œì£¼ë„ëˆê¹ŒìŠ¤ë§›ì§‘',
 '#ì œì£¼íŒŒìŠ¤íƒ€',
 
date = soup.select('time._1o9PC.Nzb55')[0]['datetime'][:10]
date
>>>
'2022-01-17'

# í•œë²ˆì— í‘œí˜„í•˜ê¸°
def get_content(driver):
    html = driver.page_source
    soup = BeautifulSoup(html, 'html.parser')
    
    try:
        content = soup.select('div.C4VMK > span')[0].text
        content = unicodedata.normalize('NFC', content) 
    except:
        content = " "
    
    tags = re.findall(r'#[^\s#,\\]+', content)
    date = soup.select('time._1o9PC.Nzb55')[0]['datetime'][:10]
    
    try:
        like = soup.select('a.zV_Nj > span')[0].text
    except:
        like = 0
    
    try: 
        place = soup.select('div.M30cS')[0].text
        place = unicodedata.normalize('NFC', place)
    except:
        place = ""
    
    data = [content, date, like, place, tags]
    return (data)
 
mylist = get_content(driver)
mylist
>>>
['(ê´‘ê³ ) ëˆê¹ŒìŠ¤ í™˜ì¥í•˜ëŠ” ì‚¬ëŒë“¤ ë‹¤ ë“œë£¨ì™€~ë“œë£¨ì™€~ğŸ¤©ğŸ¥©í•µê°€ì„±ë¹„&ë§› ê¹Œì§€ ì¡ì€ ëŒ€ì™• ë„ë§ˆí˜¸í¬ ëˆê¹ŒìŠ¤ ë§›ì§‘ ì ì‹¬ë©”ë‰´ë¡œ ì¶”ì²œ~~ğŸ¤­(ë¨¹ìœ¼ë©´ ì €ë…ê¹Œì§€ ë°°ë¶€ë¥¸ê±° ì‹¤í™”?)í™”ë•&ê·¸ë¦´ ìš”ë¦¬ë§›ì§‘ì´ë¼ í™”ë•í”¼ì,íŒŒìŠ¤íƒ€ë“± ëŒ€ë¶€ë¶„ ìš”ë¦¬ê°€ ë§›ìˆê³  ì™€ì¸ì´ ê°€ë“í•œ ì…€ëŸ¬ê°€ ìˆì–´ì„œì €ë…ì—ëŠ” ë¶„ìœ„ê¸° ì¢‹ê²Œ í•œì”í•˜ê¸° ì¢‹ìŒğŸ·ğŸ§­ í™”ë•ì•¤ê·¸ë¦´ğŸ—º ì œì£¼ ì œì£¼ì‹œ êµ­ê¸°ë¡œ 23 ğŸ“ 010-4068-9870#ì œì£¼ë„ë§›ì§‘ #ì œì£¼ë§›ì§‘#ì‹ ì œì£¼ë§›ì§‘#ë…¸í˜•ë§›ì§‘#ë…¸í˜•ë™ë§›ì§‘#ë…¸í˜•ë§›ì§‘ì¶”ì²œ#ì œì£¼ë„ëˆê¹ŒìŠ¤#ì œì£¼ë„ëˆê¹ŒìŠ¤ë§›ì§‘#ì œì£¼íŒŒìŠ¤íƒ€#ì œì£¼íŒŒìŠ¤íƒ€ë§›ì§‘#ì œì£¼í”¼ì#ì œì£¼í”¼ìë§›ì§‘#ì œì£¼ì™€ì¸#ì œì£¼ì™€ì¸ë°”#ì œì£¼ì ì‹¬',
 '2022-01-17',
 0,
 '',
 ['#ì œì£¼ë„ë§›ì§‘',
  '#ì œì£¼ë§›ì§‘',
  '#ì‹ ì œì£¼ë§›ì§‘',
```



#### ì¸ìŠ¤íƒ€ì—ì„œ ì œì£¼ë„ ë§›ì§‘ ìƒìœ„ 10ê°œ í¬ë¡¤ë§ í›„ ë°ì´í„°í”„ë ˆì„ìœ¼ë¡œ ë‚˜íƒ€ë‚´ê¸°

```python
def move_next(driver):
    right = driver.find_element(By.CSS_SELECTOR, 'div.l8mY4.feth3')
    right.click()   
    time.sleep(3)
    
move_next(driver)

driver = webdriver.Chrome(service = ser) 

driver.get('https://www.instagram.com')
time.sleep(2)

def insta_crawling(word, n):
    url = insta_searching(word)
    
    driver.get(url)
    time.sleep(5)
    
    select_first(driver)
    time.sleep(5)
    
#     target = n
    results = []
    
    for i in range(n):
        try:
            data = get_content(driver)
            results.append(data)
            move_next(driver)
            
        except:
            time.sleep(2)
            move_next(driver)
            
    return(results)

result_1 = insta_crawling('ì œì£¼ë„ë§›ì§‘', 10)

import pandas as pd

results_df = pd.DataFrame(result_1)
results_df.columns = ['content','data','like','place','tags']
results_df
>>>
	content	data	like	place	tags
0	(ê´‘ê³ ) ëˆê¹ŒìŠ¤ í™˜ì¥í•˜ëŠ” ì‚¬ëŒë“¤ ë‹¤ ë“œë£¨ì™€~ë“œë£¨ì™€~ğŸ¤©ğŸ¥©í•µê°€ì„±ë¹„&ë§› ê¹Œì§€ ì¡ì€ ëŒ€ì™• ...	2022-01-17	0		[#ì œì£¼ë„ë§›ì§‘, #ì œì£¼ë§›ì§‘, #ì‹ ì œì£¼ë§›ì§‘, #ë…¸í˜•ë§›ì§‘, #ë…¸í˜•ë™ë§›ì§‘, #ë…¸í˜•ë§›ì§‘ì¶”ì²œ...
1	<ê´‘ê³ >ì˜¨ê°€ì¡±ì´ ì¦ê¸¸ ìˆ˜ ìˆëŠ” ì œì£¼ê°ˆë¹„êµ­ìˆ˜!!ğŸ’•âœ”ì†ì†Œë…ì œ í•­ì‹œ ë°°ì¹˜(ì…ì¥ì‹œ ì…êµ¬ë¶€í„°...	2022-01-16	0		[#ì œì£¼ë§›ì§‘, #ì œì£¼ë„ë§›ì§‘, #ì œì£¼ì•„ì¿ ì•„í”Œë¼ë„·, #í‘œì„ ë§›ì§‘, #ì„±ì‚°ë§›ì§‘, #ì„±ì‚°ì¼ì¶œ...
2	22.01.17.ìƒˆí•´ì˜ ì‹œê°„ë„ ë„ˆë¬´ë‚˜ë„ ë¹ ë¥´ê²Œ í˜ëŸ¬ê°€ëŠ”ê²ƒì´ ì•„ì‰½ì§€ë§Œ ë´„ì´ ê°€ê¹Œì›Œì§€ëŠ”...	2022-01-17	797	ëª©ìŠ¤í‚¤ì¹œ-Mokskitchen	[#ëª©ìŠ¤í‚¤ì¹œ, #ì œì£¼ë§›ì§‘, #ì„œê·€í¬í•´ë¬¼ë¼ë©´, #ì œì£¼ë„ë§›ì§‘, #ì„œê·€í¬ë§›ì§‘]
3	ì–´ì œ ì €ë… ëª¨ëª¨ì°¡ì˜ ìƒˆ ì¹œêµ¬ í­êµ¬ì™€ í•¨ê»˜ğŸ§ í­êµ¬ë„ ê¼­ ê°™ì´ ì°ì–´ë‹¬ë¼ë©° êµ³~~ì´ ë‚‘ê°€...	2022-01-17	3,900		[#ê¸ˆëŠ¥ë‚™ì›, #ê³ ê¸°êµ­ìˆ˜, #ë”ë² ê³ ê¸°, #í•œë¼ì‚°, #ëŒë‹´ì´ìš°ë‹¤íœì…˜, #ìœ í•˜ë¡œí•˜ë„¤_ì œ...
4	ë˜ ë¨¹êµ¬ì‹¶ì–´ìš”! ì œ í”„ë¡œí•„ë§í¬ì—ëŠ” ë‹¤ì–‘í•œ ìŒì‹ë“¤ì´ ì¤€ë¹„ë˜ì–´ ìˆìœ¼ë‹ˆ êµ¬ê²½ì˜¤ì„¸ìš”ğŸ˜³ğŸ²#ë¨¹...	2022-01-16	180		[#ë¨¹íŒ”, #ë§›ìˆë‹¤, #ë§›ì§‘, #ë¨¹ìŠ¤íƒ€ê·¸ë¨, #ì¼ìƒ, #ìŒì‹, #ìš”ë¦¬, #ë¨¹ë¶€ë¦¼, ...
5	ê¸ˆë”¸ê¸°ì™€ ìƒí¬ë¦¼ì˜ ë§Œë‚¨ğŸ“ğŸ“ìŒ‰ì‹¸ë¦„í•œ ì•„ë©”ë¦¬ì¹´ë…¸ì™€ ì˜ ì–´ìš¸ë¦¬ëŠ” ë‹¬ì½¤í•œ ë§›â™¥ï¸ë”¸ê¸°ìƒŒë“œì™€ ...	2022-01-17	291	ì›”ì •ë¦¬í•´ë³€	[#ì•ˆë…•í•˜ìƒŒ]
6	ì œì£¼ ì• ì›”ì— ìœ„ì¹˜í•œ í˜„ì§€ì¸ë“¤ì˜ ì¶”ì²œ ë§›ì§‘ #jival ì‚¬ì¥ë‹˜ì´ ì§ì ‘ ìš”ë¦¬í•˜ì‹œëŠ” ì• ì›”...	2022-01-16	528	JIVAL	[#jival, #ì• ì›”ë§›ì§‘, #ì• ì›”ë§›ì§‘ì¶”ì²œ, #ì œì£¼ë§›ì§‘, #ì œì£¼ë§›ì§‘ì¶”ì²œ, #ì œì£¼ë„ë§›...
7	í˜¼ìë§Œ ì•Œê³  ìˆìœ¼ë ¤ê³  í–ˆì§€ë§Œ í˜¼ì ì•Œê³ ìˆê¸°ì—”ë„ˆë¬´ë‚˜ ì•„ê¹Œìš´ ë§›ì´ë¼ ëª¨ë“  ì‚¬ëŒë“¤ì´ ì´ ...	2022-01-16	127	í˜‘ì¬í•´ìˆ˜ìš•ì¥	[#í˜‘ì¬ë§›ì§‘ì¶”ì²œ, #ì• ì›”ë§›ì§‘ì¶”ì²œ, #í˜‘ì¬ë§›ì§‘, #í•œë¦¼ë§›ì§‘, #ì• ì›”ë§›ì§‘, #ì œì£¼ë§›ì§‘ë°”...
8	#ê·¸ë‚ ì˜ê¸°ì–µë°©ë²• ì•„ê¸°ìê¸° ê·€ì—¬ìš´ â€˜ì„¸ëª¨ ì œì£¼â€™ë™ìª½ êµ¬ì¢Œì í–‰ì›ë¦¬ì— ì£¼ë¨¹ë°¥ í…Œì´í¬ì•„ì›ƒ...	2022-01-16	7,651	ì„¸ëª¨ì œì£¼	[#ê·¸ë‚ ì˜ê¸°ì–µë°©ë²•]
9	ğŸ’™ğŸ’™	2022-01-18	0		[]
10	.ì• ì›” ë¡œë“œ129ì„±ê²Œí¬ë¦¼íŒŒìŠ¤íƒ€í‘ë¼ì§€ ë©˜ì¹˜ì¹´ì¸ í‘ë¼ì§€ ì¹˜ì¦ˆëˆê¹ŒìŠ¤í‘ë¼ì§€ ê³ êµ¬ë§ˆì¹˜ì¦ˆëˆê¹ŒìŠ¤í‘...	2022-01-18	0		[#ì• ì›”ë§›ì§‘, #ì œì£¼ë§›ì§‘, #ì• ì›”ìë§›ì§‘, #ì• ì›”í•­ë§›ì§‘, #ì œì£¼ì• ì›”ì ì‹¬, #ì• ì›”ë§›ì§‘ì¶”...
```



#### ì—¬ëŸ¬ ì—‘ì…€ íŒŒì¼ì˜ ì¤‘ë³µì„ ì œê±°í•œ í›„ í†µí•© ì €ì¥

```python
jeju_insta_df = pd.DataFrame( [ ] )

folder = './files/'
f_list = ['1_crawling_jejudoMatJip.xlsx', '1_crawling_jejudoGwanGwang.xlsx', '1_crawling_jejuMatJip.xlsx', '1_crawling_jejuYeoHang.xlsx']
for fname in f_list:
    fpath = folder + fname
    temp = pd.read_excel(fpath)
    jeju_insta_df = jeju_insta_df.append(temp)

jeju_insta_df.columns =['content','data','like','place','tags']

jeju_insta_df.drop_duplicates(subset = [ "content"] , inplace = True)
jeju_insta_df.to_excel('./files/1_crawling_raw.xlsx', index = False)

# ë§ì´ ì‚¬ìš©ëœ í•´ì‹œíƒœê·¸ í™•ì¸
tags_total = []

for tags in raw_total['tags']:
    tags_list = tags[2:-2].split("', '")
    for tag in tags_list:
        tags_total.append(tag)
        
tag_counts.most_common(50)
[('#ì œì£¼ë§›ì§‘', 3412),
 ('#ì œì£¼ë„ë§›ì§‘', 3149),
 ('#ì œì£¼ì—¬í–‰', 3020),
 ('#ì œì£¼ê´€ê´‘', 2827),
 ('#ì œì£¼ë„', 2053),
 ('#ì œì£¼', 1538),
 ('#ì œì£¼ë„ì—¬í–‰', 1454),
 ('#ì„œê·€í¬ë§›ì§‘', 1330),
 ('#ì œì£¼ë„ê°€ë³¼ë§Œí•œê³³', 1014),
 ('#ì œì£¼í•«í”Œë ˆì´ìŠ¤', 835),
 ('#ì„œê·€í¬', 825),
 ('#jeju', 749),
 ('#ì¼ìƒ', 701),
 ('#ì œì£¼í‘ë¼ì§€ë§›ì§‘', 685),
 ('#ì œì£¼ë§›ì§‘ì¶”ì²œ', 675),
 ('#ì œì£¼ë„í‘ë¼ì§€ë§›ì§‘', 669),

# ì œì£¼ë„ ë§›ì§‘ê³¼ ë¬´ê´€í•œ í•´ì‹œíƒœê·¸ ì œì™¸
STOPWORDS = ['#ì¼ìƒ', '#ì„ íŒ”', '#ì œì£¼ë„', '#jeju', '#ë°˜ì˜êµ¬', '#ì œì£¼ìì—°ëˆˆì¹',
'#ì„œê·€í¬ëˆˆì¹ë¬¸ì‹ ', '#ì œì£¼ëˆˆì¹ë¬¸ì‹ ', '#ì†Œí†µ', '#ë§íŒ”']

tag_total_selected = []
for tag in tags_total:
    if tag not in STOPWORDS:
        tag_total_selected.append(tag)
        
tag_counts_selected = Counter(tag_total_selected)
tag_counts_selected.most_common(50)


# ë§‰ëŒ€ì°¨íŠ¸ë¡œ í•´ì‹œíƒœê·¸ ì‚´í´ë³´ê¸°
import matplotlib.pyplot as plt
import seaborn as sns
from matplotlib import font_manager, rc
import sys

if sys.platform in ["win32", "win64"]:
    font_name = "malgun gothic"
elif sys.platform == "darwin":
    font_name = "AppleGothic"

rc('font',family=font_name)

tag_counts_df = pd.DataFrame(tag_counts_selected.most_common(30))
tag_counts_df.columns = ['tags', 'counts']
 
plt.figure(figsize=(10,8)) 
sns.barplot(x='counts', y='tags', data = tag_counts_df)
plt.show()
```



#### ì§€ë„ ì‹œê°í™”

```python
import pandas as pd
raw_total = pd.read_excel('./files/1_crawling_raw.xlsx')
raw_total.head()

location_counts = raw_total['place'].value_counts( )
location_counts_df = pd.DataFrame(location_counts)
location_counts_df.to_excel('./files/3_location_counts.xlsx')

locations = list( location_counts.index )
locations 
>>>
['Jeju',
 'Jeju-do',
 'Jungle Book by Alice',
 'Seogwipo',
 'ì œì£¼ë„ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ë°•ë¬¼ê´€',
 'ì œì£¼ì—ì¸ê°ê·¤ë°­',
 'Jeju Island',
...
]

import requests

searching = 'í•©ì • ìŠ¤íƒ€ë²…ìŠ¤'
url = 'https://dapi.kakao.com/v2/local/search/keyword.json?query={}'.format(searching)

headers = {
    "Authorization": "KakaoAK 2e64d4d81d5ecc23314a748a42ed2cff"     
}

places = requests.get(url, headers = headers).json()['documents']
places
>>>
[{'address_name': 'ì„œìš¸ ë§ˆí¬êµ¬ ì„œêµë™ 395-166',
  'category_group_code': 'CE7',
  'category_group_name': 'ì¹´í˜',
  'category_name': 'ìŒì‹ì  > ì¹´í˜ > ì»¤í”¼ì „ë¬¸ì  > ìŠ¤íƒ€ë²…ìŠ¤',
  'distance': '',
  'id': '26572121',
  'phone': '1522-3232',
  'place_name': 'ìŠ¤íƒ€ë²…ìŠ¤ ì„œêµì ',
  'place_url': 'http://place.map.kakao.com/26572121',
  'road_address_name': 'ì„œìš¸ ë§ˆí¬êµ¬ ì–‘í™”ë¡œ 78',
  'x': '126.916980454434',
  'y': '37.5514601750423'},
  ...
]

places = requests.get(url, headers = headers).json()['documents']

places[1]['place_name']
print('ê²½ë„ = ', places[1]['x'])
print('ìœ„ë„ = ', places[1]['y'])3
>>>
ê²½ë„ =  126.91253700818196
ìœ„ë„ =  37.54994959743763

def find_places(searching):
    url = 'https://dapi.kakao.com/v2/local/search/keyword.json?query={}'.format(searching)
    headers = {
    "Authorization": "KakaoAK 2e64d4d81d5ecc23314a748a42ed2cff"
    }
    
    places = requests.get(url, headers = headers).json()['documents']
    place = places[0]
    
    name = place['place_name']
    x=place['x']
    y=place['y']
    data = [name, x, y, searching] 

    return data

data = find_places('ì œì£¼ê³µí•­')
data
>>>
['ì œì£¼êµ­ì œê³µí•­', '126.492769004244', '33.5070789578184', 'ì œì£¼ê³µí•­']

! pip install tqdm
from tqdm.notebook import tqdm

ocations_inform = []

for location in tqdm(locations[:200]):
    try:
        data = find_places(location)
        locations_inform.append(data)
        time.sleep(1)
    
    except:
        pass

locations_inform_df = pd.DataFrame(locations_inform)
locations_inform_df.columns = ['name_official','ê²½ë„','ìœ„ë„','ì¸ìŠ¤íƒ€ìœ„ì¹˜ëª…']
locations_inform_df.to_excel('./files/3_locations.xlsx', index=False)
locations_inform_df.head()
>>>
	name_official	ê²½ë„	ìœ„ë„	ì¸ìŠ¤íƒ€ìœ„ì¹˜ëª…
0	Jeju in aA	126.83650369902168	33.53833652360498	Jeju
1	ì„œê·€í¬ì ìˆ˜í•¨	126.558616052674	33.2393033784206	Seogwipo
2	ë°”ì´ë‚˜ííŠ¼ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ë°•ë¬¼ê´€	126.32785786016811	33.2915720831759	ì œì£¼ë„ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ë°•ë¬¼ê´€
3	ì œì£¼ì—ì¸ê°ê·¤ë°­	126.5390139270361	33.25656069063887	ì œì£¼ì—ì¸ê°ê·¤ë°­
4	ì œì£¼ë„	126.54587355630036	33.379777816446165	Jeju Island

import folium

Mt_Hanla =[33.362500, 126.533694]
map_jeju = folium.Map(location = Mt_Hanla, zoom_start = 11)

folium.TileLayer('stamenterrain').add_to(map_jeju)

for i in range(len(location_data)):
    name = location_data ['name_official'][i]    # ê³µì‹ëª…ì¹­
    count = location_data ['place'][i]           # ê²Œì‹œê¸€ ê°œìˆ˜
    size = int(count)*2
    long = float(location_data['ìœ„ë„'][i])      
    lat = float(location_data['ê²½ë„'][i])       
    folium.CircleMarker((long,lat), radius = size, color='red', popup=name).add_to(map_jeju)
    
map_jeju

from folium.plugins import MarkerCluster

locations = []
names = []

for i in range(len(location_data)):
    data = location_data.iloc[i]  # í–‰ í•˜ë‚˜ì”©
    locations.append((float(data['ìœ„ë„']),float(data['ê²½ë„'])))    # ìœ„ë„ , ê²½ë„ ìˆœìœ¼ë¡œ..
    names.append(data['name_official'])


Mt_Hanla =[33.362500, 126.533694]
map_jeju2 = folium.Map(location = Mt_Hanla, zoom_start = 11)
                       
marker_cluster = MarkerCluster(
    locations=locations, popups=names,
    name='Jeju',
    overlay=True,
    control=True,

)

marker_cluster.add_to(map_jeju2)
folium.LayerControl().add_to(map_jeju2)

map_jeju2
```

